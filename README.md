# Personal AI Assistant (Bun + Telegram + Google Suite)

## Monorepo layout
- `apps/bot`: Elysia HTTP server exposing health and Telegram webhook endpoints.
- `packages/core`: Shared configuration, database schema, encryption helpers, and logging utilities.
- `drizzle`: SQL migrations generated by Drizzle.

## Prerequisites
- [Bun](https://bun.sh) (latest stable)
- Docker (for Postgres) and docker-compose
- Telegram Bot token
- Google Cloud OAuth credentials (web application)

## Setup
1. Copy environment configuration:
   ```bash
   cp .env.example .env
   ```
2. Start Postgres locally:
   ```bash
   docker-compose up -d db
   ```
3. Install dependencies:
   ```bash
   bun install
   ```
4. Run database migrations (from project root):
   ```bash
   bun run --filter @aissist/core drizzle:migrate
   ```
5. Start the bot server:
   ```bash
   bun run dev:bot
   ```

## Telegram webhook
Set your bot webhook to point at your server (replace `PUBLIC_BASE_URL`):
```bash
curl -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/setWebhook" \
  -d "url=${PUBLIC_BASE_URL}/webhook/telegram"
```
The `/health` endpoint returns `{ "status": "ok" }` for monitoring.

## Google Cloud setup
- Create OAuth 2.0 credentials (Web application) and configure the redirect URI to `https://<your-domain>/oauth/callback` (or `http://localhost:3000/oauth/callback` for local testing).
- Populate `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`, and `GOOGLE_REDIRECT_URI` in your `.env`.

## Local development commands
- **Run app:** `bun run dev:bot`
- **Generate migrations:** `bun run --filter @aissist/core drizzle:generate`
- **Apply migrations:** `bun run --filter @aissist/core drizzle:migrate`
- **Tests:** `bun test`

## Notes
- Telegram integration uses [grammY](https://grammy.dev/) in webhook mode for reliability and Bun compatibility.
- Elysia is the chosen HTTP server for Bun-native performance.
- Google OAuth tokens must be at least 32 characters (see `MASTER_ENCRYPTION_KEY`) and are encrypted at rest using AES-256-GCM.
